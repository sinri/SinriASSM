{
  "name": "SinriASSM",
  "tagline": "Sinri Apache Server Status Monitor",
  "body": "# SinriASSM\r\nSinri Apache Server Status Monitor\r\n\r\n## Fact\r\n\r\nWe use apache to host web site to provide service, and also some cronjob scripts run on the same server. Recently more and more requests comes and server failed serveral time, however I cannot know for what it died. At least I should know which process blocked the common jobs.\r\n\r\nCommand `ps` or `top` could display CPU and time, but it could not show details for apache processes. We have to read the PID from here, and search it in Apache Server Status page for detail request, to find out which file we need to optimize.\r\n\r\nWell, I wrote a script to do this automatically, including filtering processes and joining Apache Server Status information.\r\n\r\n\r\n## Principle\r\n\r\nGive a percent constant and filter processes with `ps aux`, any processes using CPU over this would be left, and then check Apache (Version 2.2) Server Status page, join the very line to the process with PID.\r\n\r\n## Sample Output\r\n\r\n\tljni@hz97-164-23:~$ php SinriASSM.php \r\n\tCheck any processes using beyond 0% of Full CPU...\r\n\tCurrent Process Count: 44\r\n\tFiltered to 10\r\n\t#PID: 1150\r\n\twww-data  1150  0.3  0.1 265204 23444 ?        S    20:53   0:19 /usr/sbin/apache2 -k start\r\n\t7-1\t1150\t0/639/183327\t_\t19.68\t21\t1\t0.0\t1.88\t755.08\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/misc/thickbox.js\tHTTP/1.0\r\n\t#PID: 3853\r\n\tnobody    3853  0.1  0.0  18596  1576 ?        DN   06:25   0:59 /usr/bin/find / -ignore_readdir_race ( -fstype NFS -o -fstype nfs -o -fstype nfs4 -o -fstype afs -o -fstype binfmt_misc -o -fstype proc -o -fstype smbfs -o -fstype autofs -o -fstype iso9660 -o -fstype ncpfs -o -fstype coda -o -fstype devpts -o -fstype ftpfs -o -fstype devfs -o -fstype mfs -o -fstype shfs -o -fstype sysfs -o -fstype cifs -o -fstype lustre_lite -o -fstype tmpfs -o -fstype usbfs -o -fstype udf -o -fstype ocfs2 -o -type d -regex \\(^/tmp$\\)\\|\\(^/usr/tmp$\\)\\|\\(^/var/tmp$\\)\\|\\(^/afs$\\)\\|\\(^/amd$\\)\\|\\(^/alex$\\)\\|\\(^/var/spool$\\)\\|\\(^/sfs$\\)\\|\\(^/media$\\)\\|\\(^/var/lib/schroot/mount$\\) ) -prune -o -print0\r\n\r\n\t#PID: 4701\r\n\twww-data  4701  0.7  0.1 265984 25212 ?        S    21:12   0:35 /usr/sbin/apache2 -k start\r\n\t3-1\t4701\t0/518/201767\t_\t35.27\t13\t31\t0.0\t1.58\t834.13\t192.168.2.5\tecadmin.leqee.com\tPOST\t/admin/refund_list_new.php?request=ajax\tHTTP/1.0\r\n\t#PID: 4702\r\n\twww-data  4702  0.3  0.1 263348 21760 ?        S    21:12   0:16 /usr/sbin/apache2 -k start\r\n\t9-1\t4702\t0/525/174010\t_\t16.12\t21\t166\t0.0\t1.29\t750.48\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/orderV2/sales_order_edit_ajax.php?order_id=14868138&amp;\t\r\n\t#PID: 5942\r\n\twww-data  5942  0.5  0.1 269568 27252 ?        S    18:21   1:15 /usr/sbin/apache2 -k start\r\n\t8-1\t5942\t0/1974/181610\tW\t77.82\t0\t0\t0.0\t8.07\t726.81\t192.168.2.5\tecadmin.leqee.com\tGET\t/server-status\tHTTP/1.0\r\n\t#PID: 6470\r\n\twww-data  6470  0.5  0.1 268456 24836 ?        S    18:24   1:24 /usr/sbin/apache2 -k start\r\n\t5-1\t6470\t0/2113/195297\t_\t84.99\t21\t1\t0.0\t8.76\t788.03\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/misc/thickbox.css\tHTTP/1.0\r\n\t#PID: 8217\r\n\twww-data  8217  0.3  0.1 259376 18276 ?        S    21:31   0:11 /usr/sbin/apache2 -k start\r\n\t0-1\t8217\t0/399/207486\t_\t11.42\t21\t1\t0.0\t0.94\t873.15\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/sale_support/images/image/bg_header.jpg\tHTTP/1.0\r\n\t#PID: 8218\r\n\twww-data  8218  0.3  0.1 267280 26032 ?        S    21:31   0:10 /usr/sbin/apache2 -k start\r\n\t2-1\t8218\t0/388/198819\t_\t10.75\t21\t4\t0.0\t1.65\t788.28\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/misc/jquery.js\tHTTP/1.0\r\n\t#PID: 20443\r\n\twww-data 20443  0.5  0.1 265960 25376 ?        S    19:41   0:59 /usr/sbin/apache2 -k start\r\n\t6-1\t20443\t0/1195/196828\t_\t60.29\t21\t1\t0.0\t4.24\t794.00\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/styles/css/css_2007.9.8.css\tHTTP/1.0\r\n\t#PID: 23539\r\n\twww-data 23539  0.3  0.1 263640 22800 ?        S    19:59   0:34 /usr/sbin/apache2 -k start\r\n\t4-1\t23539\t0/1031/204411\t_\t33.63\t20\t73\t0.0\t4.22\t832.51\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/sale_support/sale_support.php?order_id=14868138\tHTTP\r\n\t#PID: 29145\r\n\twww-data 29145  0.3  0.1 265496 24128 ?        S    20:29   0:26 /usr/sbin/apache2 -k start\r\n\t10-1\t29145\t0/792/152525\t_\t26.35\t21\t1\t0.0\t2.30\t622.14\t192.168.2.5\tecadmin.leqee.com\tGET\t/admin/styles/css/css.css\tHTTP/1.0\r\n\tljni@hz97-164-23:~$ \r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}